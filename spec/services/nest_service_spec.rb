RSpec.describe NestService do
  before(:each) do
    puts PanelModel.count
    @client = Client.create!(name: 'client')
    @job = @client.jobs.create!(name: 'job')
    @phase = @job.phases.create!(name: 'phase')
    @structure = @phase.structures.create!(
      name: 'testSTRUCTURE', quick_h: 48, quick_w: 40, quick_l: 40
    )
  end

  it 'creates svg' do
    @structure.panels.last.save!
    mfg = ManufacturingJob.create!(name: 'TEST', phase: @phase, parts: @structure.parts)
    expect(mfg.nest_runs.last.nests.where.not(map_svg: nil).last.map_svg).to eq(nest_map_svg)
    expect(mfg.nest_runs.last.nests.where.not(svg: nil).last.svg).to eq(nest_svg)
  end

  def nest_svg
    "<?xml version=\"1.0\" standalone=\"no\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<svg width=\"6912.0\" height=\"3456.0\" viewBox=\"0 0 6912.0 3456.0\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"><g id=\"scores\"/><g id=\"holes\"><g><circle cx=\"36.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"324.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"612.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"900.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"1188.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"1476.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"1764.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2052.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2340.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2628.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2844.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2772.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2484.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2196.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"1908.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"1620.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"1332.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"1044.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"756.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"468.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"180.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"108.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"36.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"36.0\" cy=\"3132.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"36.0\" cy=\"2844.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"36.0\" cy=\"2556.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"36.0\" cy=\"2268.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"36.0\" cy=\"1980.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"36.0\" cy=\"1692.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"36.0\" cy=\"1404.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"36.0\" cy=\"1116.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"36.0\" cy=\"828.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"36.0\" cy=\"540.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"36.0\" cy=\"252.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"36.0\" cy=\"108.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2844.0\" cy=\"3402.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2844.0\" cy=\"3114.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2844.0\" cy=\"2826.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2844.0\" cy=\"2538.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2844.0\" cy=\"2250.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2844.0\" cy=\"1962.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2844.0\" cy=\"1674.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2844.0\" cy=\"1386.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2844.0\" cy=\"1098.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2844.0\" cy=\"810.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2844.0\" cy=\"522.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2844.0\" cy=\"234.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2844.0\" cy=\"126.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/></g><g><circle cx=\"2934.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"3222.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"3510.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"3798.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"4086.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"4374.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"4662.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"4950.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"5238.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"5526.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"5742.0\" cy=\"36.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"5670.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"5382.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"5094.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"4806.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"4518.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"4230.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"3942.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"3654.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"3366.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"3078.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"3006.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2934.0\" cy=\"3420.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2934.0\" cy=\"3132.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2934.0\" cy=\"2844.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2934.0\" cy=\"2556.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2934.0\" cy=\"2268.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2934.0\" cy=\"1980.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2934.0\" cy=\"1692.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2934.0\" cy=\"1404.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2934.0\" cy=\"1116.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2934.0\" cy=\"828.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2934.0\" cy=\"540.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2934.0\" cy=\"252.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"2934.0\" cy=\"108.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"5742.0\" cy=\"3402.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"5742.0\" cy=\"3114.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"5742.0\" cy=\"2826.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"5742.0\" cy=\"2538.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"5742.0\" cy=\"2250.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"5742.0\" cy=\"1962.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"5742.0\" cy=\"1674.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"5742.0\" cy=\"1386.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"5742.0\" cy=\"1098.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"5742.0\" cy=\"810.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"5742.0\" cy=\"522.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"5742.0\" cy=\"234.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/><circle cx=\"5742.0\" cy=\"126.0\" r=\"9.0\" style=\"stroke:black;fill:white;stroke-width:0.5;\"/></g></g><g id=\"cuts\"><g><rect x=\"0.0\" y=\"0.0\" width=\"2880.0\" height=\"3456.0\" style=\"stroke:black;fill:none;stroke-width:1;\"/></g><g><rect x=\"2898.0\" y=\"0.0\" width=\"2880.0\" height=\"3456.0\" style=\"stroke:black;fill:none;stroke-width:1;\"/></g></g></svg>"
  end

  def nest_map_svg
    "<?xml version=\"1.0\" standalone=\"no\"?>\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<svg width=\"960.0\" height=\"480.0\" viewBox=\"0 0 960.0 480.0\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"><rect x=\"0\" y=\"0\" width=\"960.0\" height=\"480.0\" style=\"fill:#f9f9f9;stroke:black;\"/><rect x=\"0.0\" y=\"0.0\" width=\"400.0\" height=\"480.0\" style=\"fill:#222;stroke:none;\"/><text x=\"200.0\" y=\"233.0\" font-family=\"Helvetica\" font-size=\"10pt\" text-anchor=\"middle\" style=\"fill:white;\">testSTRUCTURE C</text><text x=\"200.0\" y=\"245.0\" font-family=\"Helvetica\" font-size=\"10pt\" text-anchor=\"middle\" style=\"fill:white;\">Standard Surface</text><text x=\"200.0\" y=\"257.0\" font-family=\"Helvetica\" font-size=\"10pt\" text-anchor=\"middle\" style=\"fill:white;\">40.0in 48.0in</text><rect x=\"402.5\" y=\"0.0\" width=\"400.0\" height=\"480.0\" style=\"fill:#222;stroke:none;\"/><text x=\"602.5\" y=\"233.0\" font-family=\"Helvetica\" font-size=\"10pt\" text-anchor=\"middle\" style=\"fill:white;\">testSTRUCTURE D</text><text x=\"602.5\" y=\"245.0\" font-family=\"Helvetica\" font-size=\"10pt\" text-anchor=\"middle\" style=\"fill:white;\">Standard Surface</text><text x=\"602.5\" y=\"257.0\" font-family=\"Helvetica\" font-size=\"10pt\" text-anchor=\"middle\" style=\"fill:white;\">40.0in 48.0in</text></svg>"
  end
end
